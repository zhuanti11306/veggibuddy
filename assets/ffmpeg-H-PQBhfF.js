var n;(function(s){s.LOAD="LOAD",s.EXEC="EXEC",s.FFPROBE="FFPROBE",s.WRITE_FILE="WRITE_FILE",s.READ_FILE="READ_FILE",s.DELETE_FILE="DELETE_FILE",s.RENAME="RENAME",s.CREATE_DIR="CREATE_DIR",s.LIST_DIR="LIST_DIR",s.DELETE_DIR="DELETE_DIR",s.ERROR="ERROR",s.DOWNLOAD="DOWNLOAD",s.PROGRESS="PROGRESS",s.LOG="LOG",s.MOUNT="MOUNT",s.UNMOUNT="UNMOUNT"})(n||(n={}));const D=(()=>{let s=0;return()=>s++})(),O=new Error("ffmpeg is not loaded, call `await ffmpeg.load()` first"),L=new Error("called FFmpeg.terminate()");class A{#e=null;#r={};#s={};#n=[];#E=[];loaded=!1;#i=()=>{this.#e&&(this.#e.onmessage=({data:{id:t,type:e,data:r}})=>{switch(e){case n.LOAD:this.loaded=!0,this.#r[t](r);break;case n.MOUNT:case n.UNMOUNT:case n.EXEC:case n.FFPROBE:case n.WRITE_FILE:case n.READ_FILE:case n.DELETE_FILE:case n.RENAME:case n.CREATE_DIR:case n.LIST_DIR:case n.DELETE_DIR:this.#r[t](r);break;case n.LOG:this.#n.forEach(E=>E(r));break;case n.PROGRESS:this.#E.forEach(E=>E(r));break;case n.ERROR:this.#s[t](r);break}delete this.#r[t],delete this.#s[t]})};#t=({type:t,data:e},r=[],E)=>this.#e?new Promise((o,R)=>{const i=D();this.#e&&this.#e.postMessage({id:i,type:t,data:e},r),this.#r[i]=o,this.#s[i]=R,E?.addEventListener("abort",()=>{R(new DOMException(`Message # ${i} was aborted`,"AbortError"))},{once:!0})}):Promise.reject(O);on(t,e){t==="log"?this.#n.push(e):t==="progress"&&this.#E.push(e)}off(t,e){t==="log"?this.#n=this.#n.filter(r=>r!==e):t==="progress"&&(this.#E=this.#E.filter(r=>r!==e))}load=({classWorkerURL:t,...e}={},{signal:r}={})=>(this.#e||(this.#e=t?new Worker(new URL(t,import.meta.url),{type:"module"}):new Worker(new URL("/assets/worker-BAOIWoxA.js",import.meta.url),{type:"module"}),this.#i()),this.#t({type:n.LOAD,data:e},void 0,r));exec=(t,e=-1,{signal:r}={})=>this.#t({type:n.EXEC,data:{args:t,timeout:e}},void 0,r);ffprobe=(t,e=-1,{signal:r}={})=>this.#t({type:n.FFPROBE,data:{args:t,timeout:e}},void 0,r);terminate=()=>{const t=Object.keys(this.#s);for(const e of t)this.#s[e](L),delete this.#s[e],delete this.#r[e];this.#e&&(this.#e.terminate(),this.#e=null,this.loaded=!1)};writeFile=(t,e,{signal:r}={})=>{const E=[];return e instanceof Uint8Array&&E.push(e.buffer),this.#t({type:n.WRITE_FILE,data:{path:t,data:e}},E,r)};mount=(t,e,r)=>{const E=[];return this.#t({type:n.MOUNT,data:{fsType:t,options:e,mountPoint:r}},E)};unmount=t=>{const e=[];return this.#t({type:n.UNMOUNT,data:{mountPoint:t}},e)};readFile=(t,e="binary",{signal:r}={})=>this.#t({type:n.READ_FILE,data:{path:t,encoding:e}},void 0,r);deleteFile=(t,{signal:e}={})=>this.#t({type:n.DELETE_FILE,data:{path:t}},void 0,e);rename=(t,e,{signal:r}={})=>this.#t({type:n.RENAME,data:{oldPath:t,newPath:e}},void 0,r);createDir=(t,{signal:e}={})=>this.#t({type:n.CREATE_DIR,data:{path:t}},void 0,e);listDir=(t,{signal:e}={})=>this.#t({type:n.LIST_DIR,data:{path:t}},void 0,e);deleteDir=(t,{signal:e}={})=>this.#t({type:n.DELETE_DIR,data:{path:t}},void 0,e)}var l;(function(s){s.MEMFS="MEMFS",s.NODEFS="NODEFS",s.NODERAWFS="NODERAWFS",s.IDBFS="IDBFS",s.WORKERFS="WORKERFS",s.PROXYFS="PROXYFS"})(l||(l={}));const u=new Error("failed to get response body reader"),I=new Error("failed to complete download"),_="Content-Length",w=async(s,t)=>{const e=await fetch(s);let r;try{const E=parseInt(e.headers.get(_)||"-1"),o=e.body?.getReader();if(!o)throw u;const R=[];let i=0;for(;;){const{done:a,value:d}=await o.read(),h=d?d.length:0;if(a){if(E!=-1&&E!==i)throw I;t&&t({url:s,total:E,received:i,delta:h,done:a});break}R.push(d),i+=h,t&&t({url:s,total:E,received:i,delta:h,done:a})}const c=new Uint8Array(i);let f=0;for(const a of R)c.set(a,f),f+=a.length;r=c.buffer}catch(E){console.log("failed to send download progress event: ",E),r=await e.arrayBuffer()}return r},N=async(s,t,e=!1,r)=>{const E=e?await w(s,r):await(await fetch(s)).arrayBuffer(),o=new Blob([E],{type:t});return URL.createObjectURL(o)};export{A as F,N as t};
