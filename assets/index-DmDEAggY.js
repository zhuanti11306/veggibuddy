import{s as yt,g as _t,P as bt,u as mt,m as et,a as gt,b as ht,r as wt,l as kt,c as vt,d as qt}from"./settings.svelte-5XoKg5x_.js";import{d as Y,p as Z,n as dt,h as P,C as s,l as n,E,j as t,r as _,v as c,A as j,e as at,b as k,g as $,B as q,F as xt,w as X,a as It,u as Dt,z as st,c as St,f as Et,x as nt,G as Pt,H as Lt,t as lt,m as ot}from"./vendor-BHUJVZvY.js";import{g as Ut}from"./index-DXLImrLQ.js";import{o as it}from"./dialogs-Cklb8uX6.js";import{F as Ft}from"./firebase-Nwrn9kXS.js";var At=(o,l)=>l(1),Mt=(o,l)=>l(2),Vt=(o,l)=>l(3),zt=P('<div class="dialog svelte-o27yn2"><div class="stages svelte-o27yn2"><div class="stage-container svelte-o27yn2"><form class="stage svelte-o27yn2"><h1 class="svelte-o27yn2">註冊或登入</h1> <label class="input-slot svelte-o27yn2"><span class="svelte-o27yn2">電子郵件</span> <input type="email" name="email" class="input svelte-o27yn2" placeholder="請輸入使用者帳戶電子郵件" autocomplete="email" required/></label> <div class="spacer svelte-o27yn2"></div> <button type="submit" class="button primary svelte-o27yn2">下一步</button> <button type="button" class="button secondary svelte-o27yn2">取消</button></form> <form class="stage svelte-o27yn2"><h1 class="svelte-o27yn2">帳戶密碼</h1> <label class="input-slot svelte-o27yn2"><span class="svelte-o27yn2">密碼</span> <input type="password" name="password" class="input svelte-o27yn2" placeholder="請輸入使用者密碼" autocomplete="new-password" required/></label> <div class="spacer svelte-o27yn2"></div> <p class="error-text svelte-o27yn2"> </p> <p class="loading-text svelte-o27yn2"> </p> <button type="submit" class="button primary svelte-o27yn2">下一步</button> <button type="button" class="button secondary svelte-o27yn2">上一步</button></form> <div class="stage svelte-o27yn2"><h1 class="svelte-o27yn2">建立新帳戶</h1> <p>此電子郵件尚未註冊帳戶，確定要建立新帳戶嗎？</p> <div class="spacer svelte-o27yn2"></div> <p class="error-text svelte-o27yn2"> </p> <p class="loading-text svelte-o27yn2"> </p> <button type="submit" class="button primary svelte-o27yn2">建立帳戶</button> <button type="button" class="button secondary svelte-o27yn2">上一步</button></div></div></div></div>');function Bt(o,l){Z(l,!0);let a=_(null),v=_(null),i=_(null),u=_(void 0),p=_(void 0),b=_(void 0),d=_(void 0),f=dt({email:"",password:""});function m(r){r.blur();const w=r.children;w.length&&Array.from(w).forEach(S=>S instanceof HTMLElement&&m(S))}function x(r){if(r.preventDefault(),!t(a))return;const w=new FormData(t(a));!(f.email=w.get("email"))||!t(v)||(m(t(a)),t(v).reset(),t(v).scrollIntoView({behavior:"smooth"}))}async function L(r){if(r.preventDefault(),!t(v))return;const w=new FormData(t(v));if(f.password=w.get("password"))try{c(u,"載入中……"),c(p,void 0),await yt(f.email,f.password),l.closeDialog()}catch(z){if(console.error("登入失敗：",z),z instanceof Ft)switch(z.code){case"auth/user-not-found":t(i)&&(m(t(v)),t(i).scrollIntoView({behavior:"smooth"}));break;case"auth/wrong-password":c(p,"登入失敗，請檢查您的電子郵件和密碼是否正確。");break;case"auth/invalid-email":c(p,"登入失敗，請檢查您的電子郵件格式是否正確。");break;case"auth/too-many-requests":c(p,"登入失敗，請稍後再試。");break}}finally{c(u,void 0)}}function h(r){switch(r){case 1:l.dialog.close();break;case 2:case 3:t(a)?.scrollIntoView({behavior:"smooth"});break}}var U=zt(),R=n(U),C=n(R),D=n(C),F=s(n(D),8);F.__click=[At,h],E(D,r=>c(a,r),()=>t(a));var I=s(D,2),A=s(n(I),6),M=n(A),H=s(A,2),O=n(H),W=s(H,4);W.__click=[Mt,h],E(I,r=>c(v,r),()=>t(v));var T=s(I,2),G=s(n(T),6),V=n(G),K=s(G,2),J=n(K),N=s(K,4);N.__click=[Vt,h],E(T,r=>c(i,r),()=>t(i)),j(()=>{q(M,t(p)),q(O,t(u)),q(V,t(d)),q(J,t(b))}),at("submit",D,x),at("submit",I,L),k(o,U),$()}Y(["click"]);function jt(o,l){const a=o.target;c(l,a.value,!0)}function Ct(o,l,a){const v=o.target;if(!t(l))return;const i=t(l).get(v.value);c(a,i?{name:i.name,type:i.typeId}:null,!0)}var Ht=P("<option> </option>"),Ot=(o,l)=>l(1),Tt=(o,l)=>l(2),Gt=P('<div class="dialog svelte-1q9yfp0"><div class="stages svelte-1q9yfp0"><div class="stage-container svelte-1q9yfp0"><div class="stage svelte-1q9yfp0"><h1 class="svelte-1q9yfp0">事前準備</h1> <p>在我們開始之前，告訴我你的名字吧！不需要告訴我你的真實姓名，而是給讓我知道我應該怎麼稱呼你。</p> <label class="input-slot svelte-1q9yfp0"><span class="svelte-1q9yfp0">暱稱</span> <input class="input svelte-1q9yfp0" name="nickname" type="text" placeholder="請輸入您的暱稱" autocomplete="nickname"/></label> <div class="spacer svelte-1q9yfp0"></div> <button class="button primary svelte-1q9yfp0">下一步</button></div> <div class="stage svelte-1q9yfp0"><h1 class="svelte-1q9yfp0">選擇寵物</h1> <p>選擇一隻與你合拍的小夥伴吧！在之後的每一天，你們將會一起交流、一起成長。</p> <div class="input-slot svelte-1q9yfp0"><span class="svelte-1q9yfp0">寵物</span> <select class="input svelte-1q9yfp0" name="pet"><option disabled selected>請選擇您的寵物</option><!></select></div> <div class="spacer svelte-1q9yfp0"></div> <div class="description svelte-1q9yfp0"><!></div> <button class="button primary svelte-1q9yfp0">下一步</button> <button class="button secondary svelte-1q9yfp0">上一步</button></div> <div class="stage svelte-1q9yfp0"><h1 class="svelte-1q9yfp0">最終確認</h1> <p>最後，讓我們確認一下。<strong> </strong>，我將會如此稱呼你，而你選擇的<strong> </strong>將會是你的夥伴。<br/> 沒有問題的話，我們就可以出發啦。</p> <div class="spacer svelte-1q9yfp0"></div> <button class="button primary svelte-1q9yfp0">完成</button> <button class="button secondary svelte-1q9yfp0">返回</button></div></div></div></div>');function Kt(o,l){Z(l,!0);let a=dt([]),v=_(!1),i=_(""),u=_(null),p=_(null);xt(()=>{let e=!1;return _t().then(y=>{if(e)return;const g=new Map;if(y)for(const B of y)B.typeId!=bt.mushroom&&g.set(B.typeId,B);c(p,g,!0)}),()=>e=!0});async function b(){c(v,!0),await mt(t(i),t(u).type),l.dialog.close()}function d(e){return y=>{y.currentTarget.disabled||e()}}function f(e){a[e-1]?.scrollIntoView({behavior:"smooth"})}var m=Gt(),x=n(m),L=n(x),h=n(L),U=s(n(h),4),R=s(n(U),2);R.__input=[jt,i];var C=s(U,4),D=X(()=>d(()=>f(2)));C.__click=function(...e){t(D)?.apply(this,e)},E(h,e=>a[0]=e,()=>a?.[0]);var F=s(h,2),I=s(n(F),4),A=s(n(I),2);A.__input=[Ct,p,u];var M=n(A);M.value=M.__value="";var H=s(M);It(H,17,()=>t(p)?t(p).values():[],e=>e.typeId,(e,y)=>{var g=Ht(),B=n(g),tt={};j(()=>{q(B,t(y).name),tt!==(tt=t(y).typeId)&&(g.value=(g.__value=t(y).typeId)??"")}),k(e,g)});var O=s(I,4),W=n(O);{var T=e=>{var y=st();j(g=>q(y,g),[()=>t(p).get(t(u).type)?.description]),k(e,y)},G=e=>{var y=st("請選擇您的寵物");k(e,y)};Dt(W,e=>{t(u)&&t(p)?e(T):e(G,!1)})}var V=s(O,2),K=X(()=>d(()=>f(3)));V.__click=function(...e){t(K)?.apply(this,e)};var J=s(V,2);J.__click=[Ot,f],E(F,e=>a[1]=e,()=>a?.[1]);var N=s(F,2),r=s(n(N),2),w=s(n(r)),S=n(w),z=s(w,2),ut=n(z),Q=s(r,4),pt=X(()=>d(b));Q.__click=function(...e){t(pt)?.apply(this,e)};var ft=s(Q,2);ft.__click=[Tt,f],E(N,e=>a[2]=e,()=>a?.[2]),j(()=>{C.disabled=!t(i),V.disabled=!t(u),q(S,t(i)),q(ut,t(u)?.name),Q.disabled=t(v)||!t(i)||!t(u)}),k(o,m),$()}Y(["input","click"]);async function Nt(o,l,a){!t(l)&&(o.key==="Enter"||o.key===" ")&&await a()}var Rt=P('<div class="main svelte-17toa27" role="button" tabindex="-1"><img class="brand svelte-17toa27" alt="菜菜小伙伴"/> <p class="hint svelte-17toa27"> </p></div>'),Wt=P('<p class="loading-text svelte-17toa27">載入中...</p>'),Jt=P('<div class="loading svelte-17toa27"><p>此應用仍在開發中，<br/> 功能可能不完整或有錯誤<br/> 歡迎隨時回報問題！:D<br/></p> <!></div>');function ee(o,l){Z(l,!0);let a=_(void 0);async function v(){c(a,"正在載入使用者資料……"),await ht()||await it(Kt,{closeByOverlay:!1,closeByKeyboard:!1}),c(a,"正在載入遊戲資料……"),await Promise.all([wt(),kt()])}async function i(){if(t(a))return;c(a,"正在檢查登入狀態...");let b=await gt();c(a,void 0),b===null&&await it(Bt),b!==null&&(await v(),Ut("/game"))}var u=St(),p=Et(u);nt(p,()=>ct,b=>{var d=Jt(),f=s(n(d),2);nt(f,()=>ct.assetLoading,m=>{var x=Wt();lt(3,x,()=>ot),k(m,x)}),lt(3,d,()=>ot),k(b,d)},b=>{var d=Rt();d.__click=i,d.__keydown=[Nt,a,i];let f;var m=n(d),x=s(m,2),L=n(x);j(h=>{f=Pt(d,"",f,h),Lt(m,"src",et.title.src),q(L,t(a)??"點擊任意位置開始")},[()=>({"background-image":`url(${et.mainScreen.src})`})]),k(b,d)}),k(o,u),$()}Y(["click","keydown"]);const rt=Promise.all([qt(),vt(1500)]),Qt=vt(3e3),ct=Object.assign(Promise.all([rt,Qt]),{assetLoading:rt});export{ee as default,ct as showingLoadingScreen};
