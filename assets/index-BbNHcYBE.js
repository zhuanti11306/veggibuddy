import{g as _t,s as gt,a as bt,b as mt,u as ht,m as Y,c as wt,d as kt,r as qt,l as xt,e as ot,f as It}from"./settings.svelte-2xa11aMz.js";import{d as W,p as K,n as it,h as L,C as l,l as n,E as G,j as t,r as h,v as p,A as M,F as rt,B as S,e as Z,b as w,g as N,G as St,w as T,a as Dt,u as Et,z as $,c as Lt,f as Pt,x as tt,H as Ut,t as et,m as at}from"./vendor-BEoA47yD.js";import{g as At}from"./index-BvmVzThb.js";import{o as st}from"./dialogs-DZWjIJ8s.js";import"./firebase-LKE9M92C.js";async function Gt(o,s){try{await bt(),s.dialog.close()}catch(e){console.error("Google 登入失敗：",e)}}var Mt=(o,s)=>s(1),Ft=(o,s)=>s(2),zt=L('<div class="dialog svelte-o27yn2"><div class="stages svelte-o27yn2"><div class="stage-container svelte-o27yn2"><form class="stage svelte-o27yn2"><h1 class="svelte-o27yn2">註冊或登入</h1> <label class="input-slot svelte-o27yn2"><span class="svelte-o27yn2">電子郵件</span> <input type="email" name="email" class="input svelte-o27yn2" placeholder="請輸入使用者帳戶電子郵件" autocomplete="email" required/></label> <div class="spacer svelte-o27yn2"></div> <button type="submit" class="button primary svelte-o27yn2">下一步</button> <button type="button" class="button secondary svelte-o27yn2">取消</button> <hr class="divider svelte-o27yn2"/> <button type="button" class="button secondary svelte-o27yn2"><img alt="Google Icon" class="svelte-o27yn2"/> 使用 Google 登入</button></form> <form class="stage svelte-o27yn2"><h1 class="svelte-o27yn2">帳戶密碼</h1> <label class="input-slot svelte-o27yn2"><span class="svelte-o27yn2">密碼</span> <input type="password" name="password" class="input svelte-o27yn2" placeholder="請輸入使用者密碼" autocomplete="new-password" required/></label> <div class="spacer svelte-o27yn2"></div> <p class="error-text svelte-o27yn2"> </p> <p class="loading-text svelte-o27yn2"> </p> <button type="submit" class="button primary svelte-o27yn2">下一步</button> <button type="button" class="button secondary svelte-o27yn2">上一步</button></form></div></div></div>');function Bt(o,s){K(s,!0);let e=h(null),v=h(null),i=h(void 0),d=h(void 0),f=it({email:"",password:""});function y(r){r.blur();const k=r.children;k.length&&Array.from(k).forEach(E=>E instanceof HTMLElement&&y(E))}function c(r){if(r.preventDefault(),!t(e))return;const k=new FormData(t(e));!(f.email=k.get("email"))||!t(v)||(y(t(e)),t(v).reset(),t(v).scrollIntoView({behavior:"smooth"}))}async function _(r){if(r.preventDefault(),!t(v))return;const k=new FormData(t(v));if(f.password=k.get("password"))try{p(i,"載入中……"),p(d,void 0),await gt(f.email,f.password),s.closeDialog()}catch{p(d,"登入失敗，請檢查您的電子郵件和密碼是否正確。")}finally{p(i,void 0)}}function g(r){switch(r){case 1:s.dialog.close();break;case 2:t(e)?.scrollIntoView({behavior:"smooth"});break}}var m=zt(),P=n(m),q=n(P),x=n(q),F=l(n(x),8);F.__click=[Mt,g];var U=l(F,4);U.__click=[Gt,s];var C=n(U);G(x,r=>p(e,r),()=>t(e));var I=l(x,2),A=l(n(I),6),z=n(A),D=l(A,2),H=n(D),B=l(D,4);B.__click=[Ft,g],G(I,r=>p(v,r),()=>t(v)),M(r=>{rt(C,"src",r),S(z,t(d)),S(H,t(i))},[()=>_t("googleIcon").src]),Z("submit",x,c),Z("submit",I,_),w(o,m),N()}W(["click"]);function Vt(o,s){const e=o.target;p(s,e.value,!0)}function jt(o,s,e){const v=o.target;if(!t(s))return;const i=t(s).get(v.value);p(e,i?{name:i.name,type:i.typeId}:null,!0)}var Ct=L("<option> </option>"),Ht=(o,s)=>s(1),Ot=(o,s)=>s(2),Tt=L('<div class="dialog svelte-1q9yfp0"><div class="stages svelte-1q9yfp0"><div class="stage-container svelte-1q9yfp0"><div class="stage svelte-1q9yfp0"><h1 class="svelte-1q9yfp0">事前準備</h1> <p>在我們開始之前，告訴我你的名字吧！不需要告訴我你的真實姓名，而是給讓我知道我應該怎麼稱呼你。</p> <label class="input-slot svelte-1q9yfp0"><span class="svelte-1q9yfp0">暱稱</span> <input class="input svelte-1q9yfp0" name="nickname" type="text" placeholder="請輸入您的暱稱" autocomplete="nickname"/></label> <div class="spacer svelte-1q9yfp0"></div> <button class="button primary svelte-1q9yfp0">下一步</button></div> <div class="stage svelte-1q9yfp0"><h1 class="svelte-1q9yfp0">選擇寵物</h1> <p>選擇一隻與你合拍的小夥伴吧！在之後的每一天，你們將會一起交流、一起成長。</p> <div class="input-slot svelte-1q9yfp0"><span class="svelte-1q9yfp0">寵物</span> <select class="input svelte-1q9yfp0" name="pet"><option disabled selected>請選擇您的寵物</option><!></select></div> <div class="spacer svelte-1q9yfp0"></div> <div class="description svelte-1q9yfp0"><!></div> <button class="button primary svelte-1q9yfp0">下一步</button> <button class="button secondary svelte-1q9yfp0">上一步</button></div> <div class="stage svelte-1q9yfp0"><h1 class="svelte-1q9yfp0">最終確認</h1> <p>最後，讓我們確認一下。<strong> </strong>，我將會如此稱呼你，而你選擇的<strong> </strong>將會是你的夥伴。<br/> 沒有問題的話，我們就可以出發啦。</p> <div class="spacer svelte-1q9yfp0"></div> <button class="button primary svelte-1q9yfp0">完成</button> <button class="button secondary svelte-1q9yfp0">返回</button></div></div></div></div>');function Wt(o,s){K(s,!0);let e=it([]),v=h(!1),i=h(""),d=h(null),f=h(null);St(()=>{let a=!1;return mt().then(u=>{if(a)return;const b=new Map;if(u)for(const j of u)b.set(j.typeId,j);p(f,b,!0)}),()=>a=!0});async function y(){p(v,!0),await ht(t(i),t(d).type),s.dialog.close()}function c(a){return u=>{u.currentTarget.disabled||a()}}function _(a){e[a-1]?.scrollIntoView({behavior:"smooth"})}var g=Tt(),m=n(g),P=n(m),q=n(P),x=l(n(q),4),F=l(n(x),2);F.__input=[Vt,i];var U=l(x,4),C=T(()=>c(()=>_(2)));U.__click=function(...a){t(C)?.apply(this,a)},G(q,a=>e[0]=a,()=>e?.[0]);var I=l(q,2),A=l(n(I),4),z=l(n(A),2);z.__input=[jt,f,d];var D=n(z);D.value=D.__value="";var H=l(D);Dt(H,17,()=>t(f)?t(f).values():[],a=>a.typeId,(a,u)=>{var b=Ct(),j=n(b),X={};M(()=>{S(j,t(u).name),X!==(X=t(u).typeId)&&(b.value=(b.__value=t(u).typeId)??"")}),w(a,b)});var B=l(A,4),r=n(B);{var k=a=>{var u=$();M(b=>S(u,b),[()=>t(f).get(t(d).type)?.description]),w(a,u)},E=a=>{var u=$("請選擇您的寵物");w(a,u)};Et(r,a=>{t(d)&&t(f)?a(k):a(E,!1)})}var V=l(B,2),ct=T(()=>c(()=>_(3)));V.__click=function(...a){t(ct)?.apply(this,a)};var vt=l(V,2);vt.__click=[Ht,_],G(I,a=>e[1]=a,()=>e?.[1]);var R=l(I,2),J=l(n(R),2),Q=l(n(J)),dt=n(Q),ut=l(Q,2),pt=n(ut),O=l(J,4),ft=T(()=>c(y));O.__click=function(...a){t(ft)?.apply(this,a)};var yt=l(O,2);yt.__click=[Ot,_],G(R,a=>e[2]=a,()=>e?.[2]),M(()=>{U.disabled=!t(i),V.disabled=!t(d),S(dt,t(i)),S(pt,t(d)?.name),O.disabled=t(v)||!t(i)||!t(d)}),w(o,g),N()}W(["input","click"]);async function Kt(o,s,e){!t(s)&&(o.key==="Enter"||o.key===" ")&&await e()}var Nt=L('<div class="main svelte-17toa27" role="button" tabindex="-1"><img class="brand svelte-17toa27" alt="菜菜小伙伴"/> <p class="hint svelte-17toa27"> </p></div>'),Rt=L('<p class="loading-text svelte-17toa27">載入中...</p>'),Jt=L('<div class="loading svelte-17toa27"><p>此應用仍在開發中，<br/> 功能可能不完整或有錯誤<br/> 歡迎隨時回報問題！:D<br/></p> <!></div>');function ee(o,s){K(s,!0);let e=h(void 0);async function v(){p(e,"正在載入使用者資料……"),await kt()||await st(Wt,{closeByOverlay:!1,closeByKeyboard:!1}),p(e,"正在載入遊戲資料……"),await Promise.all([qt(),xt()])}async function i(){if(t(e))return;p(e,"正在檢查登入狀態...");let y=await wt();p(e,void 0),y===null&&await st(Bt),y!==null&&(await v(),At("/game"))}var d=Lt(),f=Pt(d);tt(f,()=>lt,y=>{var c=Jt(),_=l(n(c),2);tt(_,()=>lt.assetLoading,g=>{var m=Rt();et(3,m,()=>at),w(g,m)}),et(3,c,()=>at),w(y,c)},y=>{var c=Nt();c.__click=i,c.__keydown=[Kt,e,i];let _;var g=n(c),m=l(g,2),P=n(m);M(q=>{_=Ut(c,"",_,q),rt(g,"src",Y.title.src),S(P,t(e)??"點擊任意位置開始")},[()=>({"background-image":`url(${Y.mainScreen.src})`})]),w(y,c)}),w(o,d),N()}W(["click","keydown"]);const nt=Promise.all([It(),ot(1500)]),Qt=ot(3e3),lt=Object.assign(Promise.all([nt,Qt]),{assetLoading:nt});export{ee as default,lt as showingLoadingScreen};
