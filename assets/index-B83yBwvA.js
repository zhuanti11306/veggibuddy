import{g as _t,s as bt,a as gt,b as mt,P as ht,u as wt,m as at,c as kt,d as qt,r as xt,l as It,e as ut,f as St}from"./settings.svelte-Crs8jiIO.js";import{d as Z,p as $,n as dt,h as A,C as n,l as o,E as U,j as t,r as _,v as c,A as B,F as pt,B as w,e as st,b as k,g as tt,G as Dt,w as Y,a as Et,u as Pt,z as nt,c as Lt,f as Ut,x as ot,H as At,t as lt,m as it}from"./vendor-BEoA47yD.js";import{g as Ft}from"./index-Bx7Yu5Yv.js";import{o as rt}from"./dialogs-DZWjIJ8s.js";import{F as Gt}from"./firebase-ClGKOlzQ.js";async function Mt(l,s){try{await gt(),s.dialog.close()}catch(e){console.error("Google 登入失敗：",e)}}var Vt=(l,s)=>s(1),zt=(l,s)=>s(2),Bt=(l,s)=>s(3),jt=A('<div class="dialog svelte-o27yn2"><div class="stages svelte-o27yn2"><div class="stage-container svelte-o27yn2"><form class="stage svelte-o27yn2"><h1 class="svelte-o27yn2">註冊或登入</h1> <label class="input-slot svelte-o27yn2"><span class="svelte-o27yn2">電子郵件</span> <input type="email" name="email" class="input svelte-o27yn2" placeholder="請輸入使用者帳戶電子郵件" autocomplete="email" required/></label> <div class="spacer svelte-o27yn2"></div> <button type="submit" class="button primary svelte-o27yn2">下一步</button> <button type="button" class="button secondary svelte-o27yn2">取消</button> <hr class="divider svelte-o27yn2"/> <button type="button" class="button secondary svelte-o27yn2"><img alt="Google Icon" class="svelte-o27yn2"/> 使用 Google 登入</button></form> <form class="stage svelte-o27yn2"><h1 class="svelte-o27yn2">帳戶密碼</h1> <label class="input-slot svelte-o27yn2"><span class="svelte-o27yn2">密碼</span> <input type="password" name="password" class="input svelte-o27yn2" placeholder="請輸入使用者密碼" autocomplete="new-password" required/></label> <div class="spacer svelte-o27yn2"></div> <p class="error-text svelte-o27yn2"> </p> <p class="loading-text svelte-o27yn2"> </p> <button type="submit" class="button primary svelte-o27yn2">下一步</button> <button type="button" class="button secondary svelte-o27yn2">上一步</button></form> <div class="stage svelte-o27yn2"><h1 class="svelte-o27yn2">建立新帳戶</h1> <p>此電子郵件尚未註冊帳戶，確定要建立新帳戶嗎？</p> <div class="spacer svelte-o27yn2"></div> <p class="error-text svelte-o27yn2"> </p> <p class="loading-text svelte-o27yn2"> </p> <button type="submit" class="button primary svelte-o27yn2">建立帳戶</button> <button type="button" class="button secondary svelte-o27yn2">上一步</button></div></div></div></div>');function Ct(l,s){$(s,!0);let e=_(null),v=_(null),r=_(null),d=_(void 0),p=_(void 0),b=_(void 0),u=_(void 0),y=dt({email:"",password:""});function g(i){i.blur();const I=i.children;I.length&&Array.from(I).forEach(L=>L instanceof HTMLElement&&g(L))}function q(i){if(i.preventDefault(),!t(e))return;const I=new FormData(t(e));!(y.email=I.get("email"))||!t(v)||(g(t(e)),t(v).reset(),t(v).scrollIntoView({behavior:"smooth"}))}async function F(i){if(i.preventDefault(),!t(v))return;const I=new FormData(t(v));if(y.password=I.get("password"))try{c(d,"載入中……"),c(p,void 0),await bt(y.email,y.password),s.closeDialog()}catch(S){if(console.error("登入失敗：",S),S instanceof Gt)switch(S.code){case"auth/user-not-found":t(r)&&(g(t(v)),t(r).scrollIntoView({behavior:"smooth"}));break;case"auth/wrong-password":c(p,"登入失敗，請檢查您的電子郵件和密碼是否正確。");break;case"auth/invalid-email":c(p,"登入失敗，請檢查您的電子郵件格式是否正確。");break;case"auth/too-many-requests":c(p,"登入失敗，請稍後再試。");break}}finally{c(d,void 0)}}function h(i){switch(i){case 1:s.dialog.close();break;case 2:case 3:t(e)?.scrollIntoView({behavior:"smooth"});break}}var G=jt(),R=o(G),j=o(R),D=o(j),E=n(o(D),8);E.__click=[Vt,h];var M=n(E,4);M.__click=[Mt,s];var C=o(M);U(D,i=>c(e,i),()=>t(e));var x=n(D,2),H=n(o(x),6),O=o(H),T=n(H,2),J=o(T),Q=n(T,4);Q.__click=[zt,h],U(x,i=>c(v,i),()=>t(v));var P=n(x,2),W=n(o(P),6),X=o(W),V=n(W,2),K=o(V),N=n(V,4);N.__click=[Bt,h],U(P,i=>c(r,i),()=>t(r)),B(i=>{pt(C,"src",i),w(O,t(p)),w(J,t(d)),w(X,t(u)),w(K,t(b))},[()=>_t("googleIcon").src]),st("submit",D,q),st("submit",x,F),k(l,G),tt()}Z(["click"]);function Ht(l,s){const e=l.target;c(s,e.value,!0)}function Ot(l,s,e){const v=l.target;if(!t(s))return;const r=t(s).get(v.value);c(e,r?{name:r.name,type:r.typeId}:null,!0)}var Tt=A("<option> </option>"),Wt=(l,s)=>s(1),Kt=(l,s)=>s(2),Nt=A('<div class="dialog svelte-1q9yfp0"><div class="stages svelte-1q9yfp0"><div class="stage-container svelte-1q9yfp0"><div class="stage svelte-1q9yfp0"><h1 class="svelte-1q9yfp0">事前準備</h1> <p>在我們開始之前，告訴我你的名字吧！不需要告訴我你的真實姓名，而是給讓我知道我應該怎麼稱呼你。</p> <label class="input-slot svelte-1q9yfp0"><span class="svelte-1q9yfp0">暱稱</span> <input class="input svelte-1q9yfp0" name="nickname" type="text" placeholder="請輸入您的暱稱" autocomplete="nickname"/></label> <div class="spacer svelte-1q9yfp0"></div> <button class="button primary svelte-1q9yfp0">下一步</button></div> <div class="stage svelte-1q9yfp0"><h1 class="svelte-1q9yfp0">選擇寵物</h1> <p>選擇一隻與你合拍的小夥伴吧！在之後的每一天，你們將會一起交流、一起成長。</p> <div class="input-slot svelte-1q9yfp0"><span class="svelte-1q9yfp0">寵物</span> <select class="input svelte-1q9yfp0" name="pet"><option disabled selected>請選擇您的寵物</option><!></select></div> <div class="spacer svelte-1q9yfp0"></div> <div class="description svelte-1q9yfp0"><!></div> <button class="button primary svelte-1q9yfp0">下一步</button> <button class="button secondary svelte-1q9yfp0">上一步</button></div> <div class="stage svelte-1q9yfp0"><h1 class="svelte-1q9yfp0">最終確認</h1> <p>最後，讓我們確認一下。<strong> </strong>，我將會如此稱呼你，而你選擇的<strong> </strong>將會是你的夥伴。<br/> 沒有問題的話，我們就可以出發啦。</p> <div class="spacer svelte-1q9yfp0"></div> <button class="button primary svelte-1q9yfp0">完成</button> <button class="button secondary svelte-1q9yfp0">返回</button></div></div></div></div>');function Rt(l,s){$(s,!0);let e=dt([]),v=_(!1),r=_(""),d=_(null),p=_(null);Dt(()=>{let a=!1;return mt().then(f=>{if(a)return;const m=new Map;if(f)for(const z of f)z.typeId!=ht.mushroom&&m.set(z.typeId,z);c(p,m,!0)}),()=>a=!0});async function b(){c(v,!0),await wt(t(r),t(d).type),s.dialog.close()}function u(a){return f=>{f.currentTarget.disabled||a()}}function y(a){e[a-1]?.scrollIntoView({behavior:"smooth"})}var g=Nt(),q=o(g),F=o(q),h=o(F),G=n(o(h),4),R=n(o(G),2);R.__input=[Ht,r];var j=n(G,4),D=Y(()=>u(()=>y(2)));j.__click=function(...a){t(D)?.apply(this,a)},U(h,a=>e[0]=a,()=>e?.[0]);var E=n(h,2),M=n(o(E),4),C=n(o(M),2);C.__input=[Ot,p,d];var x=o(C);x.value=x.__value="";var H=n(x);Et(H,17,()=>t(p)?t(p).values():[],a=>a.typeId,(a,f)=>{var m=Tt(),z=o(m),et={};B(()=>{w(z,t(f).name),et!==(et=t(f).typeId)&&(m.value=(m.__value=t(f).typeId)??"")}),k(a,m)});var O=n(M,4),T=o(O);{var J=a=>{var f=nt();B(m=>w(f,m),[()=>t(p).get(t(d).type)?.description]),k(a,f)},Q=a=>{var f=nt("請選擇您的寵物");k(a,f)};Pt(T,a=>{t(d)&&t(p)?a(J):a(Q,!1)})}var P=n(O,2),W=Y(()=>u(()=>y(3)));P.__click=function(...a){t(W)?.apply(this,a)};var X=n(P,2);X.__click=[Wt,y],U(E,a=>e[1]=a,()=>e?.[1]);var V=n(E,2),K=n(o(V),2),N=n(o(K)),i=o(N),I=n(N,2),L=o(I),S=n(K,4),yt=Y(()=>u(b));S.__click=function(...a){t(yt)?.apply(this,a)};var ft=n(S,2);ft.__click=[Kt,y],U(V,a=>e[2]=a,()=>e?.[2]),B(()=>{j.disabled=!t(r),P.disabled=!t(d),w(i,t(r)),w(L,t(d)?.name),S.disabled=t(v)||!t(r)||!t(d)}),k(l,g),tt()}Z(["input","click"]);async function Jt(l,s,e){!t(s)&&(l.key==="Enter"||l.key===" ")&&await e()}var Qt=A('<div class="main svelte-17toa27" role="button" tabindex="-1"><img class="brand svelte-17toa27" alt="菜菜小伙伴"/> <p class="hint svelte-17toa27"> </p></div>'),Xt=A('<p class="loading-text svelte-17toa27">載入中...</p>'),Yt=A('<div class="loading svelte-17toa27"><p>此應用仍在開發中，<br/> 功能可能不完整或有錯誤<br/> 歡迎隨時回報問題！:D<br/></p> <!></div>');function ne(l,s){$(s,!0);let e=_(void 0);async function v(){c(e,"正在載入使用者資料……"),await qt()||await rt(Rt,{closeByOverlay:!1,closeByKeyboard:!1}),c(e,"正在載入遊戲資料……"),await Promise.all([xt(),It()])}async function r(){if(t(e))return;c(e,"正在檢查登入狀態...");let b=await kt();c(e,void 0),b===null&&await rt(Ct),b!==null&&(await v(),Ft("/game"))}var d=Lt(),p=Ut(d);ot(p,()=>vt,b=>{var u=Yt(),y=n(o(u),2);ot(y,()=>vt.assetLoading,g=>{var q=Xt();lt(3,q,()=>it),k(g,q)}),lt(3,u,()=>it),k(b,u)},b=>{var u=Qt();u.__click=r,u.__keydown=[Jt,e,r];let y;var g=o(u),q=n(g,2),F=o(q);B(h=>{y=At(u,"",y,h),pt(g,"src",at.title.src),w(F,t(e)??"點擊任意位置開始")},[()=>({"background-image":`url(${at.mainScreen.src})`})]),k(b,u)}),k(l,d),tt()}Z(["click","keydown"]);const ct=Promise.all([St(),ut(1500)]),Zt=ut(3e3),vt=Object.assign(Promise.all([ct,Zt]),{assetLoading:ct});export{ne as default,vt as showingLoadingScreen};
