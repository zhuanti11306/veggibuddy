import{V as m,as as k,P as x,e as W,j as F,k as L,T as H,m as O,aA as R,az as B,av as D,M,q as v,aB as T,aC as V,t as E,B as I,i as U}from"./GLTFLoader-CQaeW04e.js";import{W as j}from"./index-CiVeqNK5.js";const q="/assets/ball_normal-DnmjJmty.png",G=new H;new O;const $={camera:new x(70,window.innerWidth/window.innerHeight,.01,20),cameraPosi:new m(0,2,5),lookAt:new m(0,0,0),light:new k(16777215,12303359,3),lightPosi:new m(.5,1,.25)},ee={camera:new x(70,window.innerWidth/window.innerHeight,.01,20),cameraPosi:new m(0,0,1),lookAt:new m(0,0,0),light:new k(16777215,12303359,3),lightPosi:new m(.5,1,.25)},te={material:new L({color:16711680,roughness:.3,metalness:.1,normalMap:G.load(q)}),geometry:new F(.5,64,64),visible:!0,screenPosi:new W(window.innerWidth/2,window.innerHeight*.8),distanceToCam:3},ne={material:new R({color:4473924,dashSize:.1,gapSize:.05,linewidth:5}),scale:.1,ratio:window.innerWidth/window.innerHeight},oe={speed:.01,sideOffset:1},ie={speed:.01,rotation:.05},d={height:1920,width:1080};let n,r,a,w,g=[],C=[],y=[];async function ae(e){w=e,n=e.camera,n.position.set(e.cameraPosi.x,e.cameraPosi.y,e.cameraPosi.z),n.lookAt(e.lookAt.x,e.lookAt.y,e.lookAt.z),console.log("initThree: camera initialized."),r=new B;const t=e.light;t.position.set(e.lightPosi.x,e.lightPosi.y,e.lightPosi.z),r.add(t),console.log("initThree: scene initialized."),a=new D({antialias:!0,alpha:!0}),a.setPixelRatio(window.devicePixelRatio),document.body.appendChild(a.domElement),a.setSize(window.innerWidth,window.innerHeight),console.log("initThree: renderer initialized."),console.log("ThreeJS is setup.")}function se(){n.position.set(w.cameraPosi.x,w.cameraPosi.y,w.cameraPosi.z),n.lookAt(w.lookAt.x,w.lookAt.y,w.lookAt.z)}function re(e){r.add(e)}function ce(e){r.background=null,r.background=e}let h,f,z;async function de(){h=document.createElement("video"),h.autoplay=!0,h.playsInline=!0;try{const t={video:{width:d.height,height:d.width,facingMode:"environment"}},o=await navigator.mediaDevices.getUserMedia(t);h.srcObject=o}catch(t){console.warn("無法取得後置鏡頭。",t);return}await new Promise(t=>{h.onloadedmetadata=()=>{console.log("相機背景設置完畢1"),t()}});const e=new V(h);e.minFilter=E,e.magFilter=E,e.needsUpdate=!0,r.background=e,h.play(),N(()=>{_()}),f=document.createElement("canvas"),f.width=d.width,f.height=d.height,z=f.getContext("2d"),console.log("相機背景設置完畢")}function le(){if(!h||h.readyState<h.HAVE_ENOUGH_DATA||!z)return;f.width=d.width,f.height=d.height,z.drawImage(h,0,0,d.width,d.height);const e=document.createElement("canvas");e.width=d.height,e.height=d.width;const t=e.getContext("2d");return t.translate(e.width/2,e.height/2),t.rotate(-Math.PI/2),t.drawImage(f,-1080/2,-1920/2,d.width,d.height),{img:e,width:e.width,height:e.height}}function he(e,t,o){const i=e/window.innerWidth*2-1,l=-(t/window.innerHeight*2-1),s=new m(i,l,.5).unproject(n).sub(n.position).normalize();if(o?.distance!==void 0)return n.position.clone().add(s.multiplyScalar(o.distance));if(o?.zPlane!==void 0){const c=(o.zPlane-n.position.z)/s.z;return n.position.clone().add(s.multiplyScalar(c))}else return n.position.clone().add(s)}function me(e){if(!n)return;const t=new m;n.getWorldDirection(t),t.y=0,t.normalize();const o=t.clone().multiplyScalar(-e);n.position.add(o)}function pe(e){if(!(n instanceof x))return;const t=n.position.clone(),o=new I().setFromObject(e),i=new m;o.getSize(i);const l=i.x,s=U.degToRad(n.fov),c=Math.tan(s/2)*n.aspect,p=l/(2*c),u=e.getWorldPosition(new m).z;return n.position.z=u+p,()=>{n.position.copy(t)}}function ue(e){n.position.set(e.x,e.y,e.z),C.forEach(t=>{t()})}function we(e,t){let o=0,i=t[1]-t[0],l=!0,s=!1;i==0&&(i=t[0],l=!1);function c(u){if(s)return;if(o===0&&(o=u),u-o>=i&&(o=u,e(),a?.render(r,n),l)){const[A,b]=t;i=Math.random()*(b-A)+A}requestAnimationFrame(c)}requestAnimationFrame(c);let p=()=>{s=!0,g=g.filter(u=>u!==p)};return g.push(p),p}function fe(e,t,o){const i=n.position;t.updateMatrixWorld(!0);const l=t.getWorldPosition(new m);e.position.copy(l),e.position.z=o;const s=Math.abs(l.z-i.z),c=Math.abs(e.position.z-i.z);if(s<1e-4||c<1e-4)return;const p=c/s;e.scale.setScalar(p),C.push(()=>{Z(e,t)})}function Z(e,t){const o=e.position.z,i=t.position,l=i.z-n.position.z,c=(o-n.position.z)/l;e.position.x=n.position.x+(i.x-n.position.x)*c,e.position.y=n.position.y+(i.y-n.position.y)*c}function N(e){a?.setAnimationLoop(()=>{e(),a?.render(r,n),y.forEach(t=>t())})}function _(){a?.render(r,n),y.forEach(e=>e())}function ge(e){return y.push(e),()=>J(e)}function J(e){const t=y.indexOf(e);t!==-1&&y.splice(t,1)}async function ye(){X()}function X(){try{a?.setAnimationLoop(null)}catch{}for(r.traverse(e=>{if(e instanceof M||e instanceof v||e instanceof T){const o=e;if(o.geometry)try{o.geometry.dispose()}catch{}P(o.material)}const t=e;if(t.material&&!(t instanceof M||t instanceof v||t instanceof T)&&P(t.material),t.texture&&t.texture.dispose)try{t.texture.dispose()}catch{}});r.children.length>0;)r.remove(r.children[0]);try{a?.forceContextLoss?.()}catch{}try{a?.dispose()}catch{}a?.domElement&&a?.domElement.parentElement&&a?.domElement.parentElement.removeChild(a?.domElement),a=void 0,g.length>0&&g.forEach(e=>e())}function P(e){if(!e)return;if(Array.isArray(e)){e.forEach(P);return}const t=e,o=["map","alphaMap","aoMap","emissiveMap","bumpMap","normalMap","displacementMap","roughnessMap","metalnessMap","specularMap","envMap"];for(const i of o)t[i]&&typeof t[i].dispose=="function"&&t[i].dispose();try{e.dispose()}catch{}}const S=j(null);function ze(e,t=2e3){S.set(e),setTimeout(()=>S.set(null),t)}export{te as B,ee as H,ne as P,oe as T,re as a,ie as b,n as c,N as d,ye as e,ae as f,he as g,ce as h,se as i,ge as j,$ as k,le as l,me as m,S as n,de as o,pe as p,we as q,_ as r,ze as s,fe as t,ue as u};
